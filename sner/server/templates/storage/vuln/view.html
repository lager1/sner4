{#- This file is part of sner4 project governed by MIT license, see the LICENSE.txt file. -#}
{% extends "base.html" %}

{% block title %}Vulns / View / {{ vuln.host.address }} {{ vuln.host.hostname }} / {{ vuln.name }}{% endblock %}

{% block script %}
<script type="text/javascript">
function action_vuln_tag(event) {
	var data = JSON.parse(event.target.closest('a').getAttribute('data-tagaction'));
	sner_submit_form(Flask.url_for('storage.vuln_tag_by_id_route'), data)
		.always(function() { window.location.reload(); });
}

$(document).ready(function() {
	$('.abutton_vuln_tag_set').on('click', action_vuln_tag);
	$('.abutton_vuln_tag_unset').on('click', action_vuln_tag);
});
</script>
{% endblock %}

{% block content %}
{{ cm.breadcrumbs(['Storage', 'Vulns', 'View', '%s %s' % (vuln.host.address, vuln.host.hostname), vuln.name]) }}

<div class="text-right">
	<a class="btn btn-outline-primary" title="Jump to same name vuln listing" href="{{ url_for('storage.vuln_list_route', filter='Vuln.name=="'+vuln.name+'"') }}"><i class="fas fa-list"></i></a>
	<div class="btn-group">
		<a class="btn btn-outline-primary disabled"><i class="fas fa-tag"></i></a>
		<a class="btn btn-outline-primary abutton_vuln_tag_set" href="#" data-tagaction='{{ {'action': 'set', 'tag': 'info', 'ids-0': vuln.id}|tojson }}'>Info</a>
		<a class="btn btn-outline-primary abutton_vuln_tag_set" href="#" data-tagaction='{{ {'action': 'set', 'tag': 'report', 'ids-0': vuln.id}|tojson }}'>Report</a>
		<a class="btn btn-outline-primary abutton_vuln_tag_set" href="#" data-tagaction='{{ {'action': 'set', 'tag': 'todo', 'ids-0': vuln.id}|tojson }}'>Todo</a>
	</div>
	<a class="btn btn-outline-primary" href="{{ url_for('storage.vuln_edit_route', vuln_id=vuln.id) }}"><i class="fas fa-edit"></i></a>
	{% with form=button_form, form_url=url_for('storage.vuln_delete_route', vuln_id=vuln.id) %}{% include 'button-delete.html' %}{% endwith %}
</div>

<dl class="row">
	<dt class="col-1">host address</dt>
	<dd class="col-11 render_hbs" data-hbs="storage_pagepart_host_link" data-hbs_context='{{ {'host_id': vuln.host.id, 'host_address': vuln.host.address}|tojson }}'>{{ vuln.host.address }}</dd>

	<dt class="col-2">host hostname</dt>
	<dd class="col-10">{{ vuln.host.hostname }}</dd>

	<dt class="col-1">service</dt>
	<dd class="col-11">{{ vuln.service }}</dd>

	<dt class="col-1">xtype</dt>
	<dd class="col-11">{{ vuln.xtype }}</dd>

	<dt class="col-1">severity</dt>
	<dd class="col-11 render_hbs" data-hbs="storage_pagepart_severity_label" data-hbs_context='{{ {'severity': vuln.severity|string}|tojson }}'>{{ vuln.severity }}</dd>

	<dt class="col-1">refs</dt>
	<dd class="col-11 render_hbs" data-hbs="storage_pagepart_vuln_refs" data-hbs_context='{{ {'refs': vuln.refs}|tojson }}'>{{ vuln.refs }}</dd>

	<dt class="col-1">tags</dt>
	<dd class="col-11">
	{% for tag in vuln.tags|sort %}
		<span class="label label-light tag-label">{{ tag }} <a class="abutton_vuln_tag_unset" data-tagaction='{{ {'action': 'unset', 'tag': tag, 'ids-0': vuln.id}|tojson }}'><i class="fas fa-trash"></i></a></span>
	{% endfor %}
	</dd>

	<dt class="col-1">comment</dt>
	<dd class="col-11">{{ vuln.comment }}</dd>
</dl>

<h2>Description</h2>
<div>
{% if vuln.descr %}{% for tmp in vuln.descr.splitlines() %}<p>{{ tmp }}</p>{% endfor %}{% endif %}
</div>

<h2>Data</h2>
<div>
	<pre>{{ vuln.data }}</pre>
</div>
{% endblock %}
